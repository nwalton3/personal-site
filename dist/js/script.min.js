function initPortfolio(){headerheight=$("header.main").height(),titleheight=$(".project:first div.title").height(),speedTest=$.hisrc.bandwidth;var e=document.location.toString(),t="",i="intro-0";if(e.match("#")){var a=e.split("#")[1];e.match("=")&&(a=a.split("=")[0]),a&&0!==$("#"+a).size()&&(i=a)}gotoSlide(i),$(window).on("hashchange",function(e){e.preventDefault();var i=window.location.hash;i!==t&&gotoSlide(i),t=i}),checkImageBreakpoints(),currentBreakpoint<1600&&$(window).on("resize",checkImageBreakpoints),$("a.infobutton").on("click",function(e){e.preventDefault(),$(".portfolio").toggleClass("show-info")}),$("nav a.next").on("click",function(e){e.preventDefault(),changeSlide()}),$("nav a.prev").on("click",function(e){e.preventDefault(),changeSlide("prev")}),$(document).keydown(function(e){return 37==e.keyCode?changeSlide(!1):39==e.keyCode&&changeSlide(!0),!1}),checkHeight(),$(window).on("resize",checkHeight),$("p, .type").each(function(e){$(this).html(typogr.typogrify($(this)))})}function checkImageBreakpoints(){var e=$(window).width(),t=$(window).height(),i=headerheight+titleheight+bottomOffset,a={w:1777,h:1200+i},o={w:888,h:600+i},n={w:444,h:300+i};e<=currentBreakpoint||(e>=a.w&&t>=a.h?currentBreakpoint!==a.w&&(updateResponsiveImages(3200,speedTest),currentBreakpoint=a.w,$(window).off("resize",checkImageBreakpoints)):e>=o.w&&t>=o.h?currentBreakpoint!==o.w&&(updateResponsiveImages(1600,speedTest),currentBreakpoint=o.w,"high"==speedTest&&$(window).off("resize",checkImageBreakpoints)):e>=n.w&&t>=n.h?currentBreakpoint!==n.w&&(updateResponsiveImages(800,speedTest),currentBreakpoint=n.w):0!==currentBreakpoint&&(updateResponsiveImages(400,speedTest),currentBreakpoint=0))}function getCurrentImageWidth(){var e=1777,t=888,i=444,a=400;return currentBreakpoint==e?a=3200:currentBreakpoint==t?a=1600:currentBreakpoint==i&&(a=800),a}function updateResponsiveImages(e,t){var i=$("img.lazy"),a=0;0!==i.size()&&(window.devicePixelRatio>=1.2&&(a=1),a&&"high"==t&&(e=2*e),i.parent().addClass("toLoad"),lazyLoadImages(e))}function lazyLoadImages(e){var t="img.lazy",i=$(".visible"),a=i.find(t),o=i.closest(".project"),n=getNextSlide(i,!0),s=$("#"+n).find(t),r=getNextSlide(i,!1),d=$("#"+r).find(t),c=o.find(t),l=getNextProject(o,!0),g=$("#"+l).find(t),h=getNextProject(o,!1),p=$("#"+h).find(t);loadImages(a,e),loadImages(s,e),Modernizr.touch||(loadImages(d,e),loadImages(c,e),"high"==speedTest&&(loadImages(g,e),loadImages(p,e)))}function loadImages(e,t){e.size()&&e.each(function(e,i){loadImage(i,t)})}function loadImage(e,t){var i=$(e),a=i.parent().hasClass("toLoad");if(a){var o=i.attr("data-src"),n=i.attr("data-ext")?i.attr("data-ext"):"",s=assetBase+o+n;i.hasClass("responsive")?s=assetBase+t+"w/"+o+n:i.hasClass("titleImage")?s=assetBase+"title-pages/"+o:i.hasClass("front")&&(s=assetBase+"400w/"+o+n),i.parent().removeClass("toLoad").addClass("loading");var r=new ImageLoader(s);r.loadEvent=function(e,t){addImage(i,e)},r.load()}}function addImage(e,t){e.attr("src",t),e.parent().removeClass("loading")}function checkHeight(){var e=$(window).height();windowHeight!=e&&resizeImage(e),windowHeight=e}function resizeImage(e){var t=e-headerheight-titleheight-bottomOffset,i=Math.floor(t+t/3);i<240&&(i=240,t=320),$(".portfolio .sizable").css("max-width",i),$(".portfolio .image.sizable").css("max-height",t)}function gotoSlide(e){var t=$(".visible"),i=t.closest(".project"),a="#"==e[0]?e:"#"+e,o=$(a).closest(".project");a.indexOf("-")===-1&&(a+="-0"),t.removeClass("visible"),$(a).addClass("visible"),lazyLoadImages(getCurrentImageWidth()),i!==o&&gotoProject(o.attr("id")),index=a.indexOf("-0"),index!==-1?window.location.hash=a.substring(0,index):window.location.hash=a.substring(0),$(window).scrollTop(0)}function gotoProject(e){$(".project.current").removeClass("current"),$("#"+e).addClass("current")}function changeSlide(e){var t=!0,i=$(".visible").first(),a="";"prev"!=e&&e!==!1&&0!==e||(t=!1),a=getNextSlide(i,t),gotoSlide(a)}function getNextSlide(e,t){if(void 0===e)return void console.log("currentSlide is undefined");var i,a="",o="",n=e.closest(".project"),s=(n.children(".slide").size(),e.attr("id").toString()),r=s.split("-"),d=r[0],c=parseInt(r[1]);return t?e.hasClass("last")?(o=getNextProject(n,t),a=getFirstSlide(o)):(i=c+1,a=d+"-"+i):e.hasClass("intro")?(o=getNextProject(n,t),a=getLastSlide(o)):(i=c-1,a=d+"-"+i),a}function getNextProject(e,t){var i=parseInt(e.attr("data-project")),a=0,o="",n=$(".project").size();return a=t?i>=n-1?0:i+1:i<1?$(".project").last().attr("data-project"):i-1,o=$(".project[data-project="+a+"]").attr("id")}function getFirstSlide(e){var t=$("#"+e),i=t.find(".slide.intro").attr("id");return i}function getLastSlide(e){var t=$("#"+e),i=t.find(".slide.last").attr("id");return i}var windowHeight=0,speedTest=null,currentBreakpoint=null,headerheight=0,titleheight=0,bottomOffset=10,assetBase=window.assets?window.assets:"";assetBase+="img/",$.hisrc.speedTest({speedTestUri:"http://nkwalton.brighamyounguniv.netdna-cdn.com/img/speed.jpg?n="+Math.random(),speedTestKB:48,speedTestExpireMinutes:5}),$(document).ready(function(){$(".main.portfolio").size()?initPortfolio():loadImages($("img.lazy"),0),$("body").addClass("load")});